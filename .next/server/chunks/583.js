exports.id=583,exports.ids=[583],exports.modules={32256:(e,r,t)=>{let a={"23bf5c0cf8f59322990bf558628baf2cfce62fc9":()=>Promise.resolve().then(t.bind(t,79955)).then(e=>e.checkoutWithStripe),"9d80f7b7bec96c223665e959afd89f228bdfc6d4":()=>Promise.resolve().then(t.bind(t,79955)).then(e=>e.createStripePortal),"3fde3a24a853a7b9918376c70d599131c9bd7620":()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.SignOut),a65f755ac9dca40b577223cfa4b7ed4d0778de79:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.updatePassword),c8b94a55ee783ffb92b5d3be3b06325dcda2c28c:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.redirectToPath),c8fb0cb6630a631d4484f2603849ab0025787db1:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.updateEmail),cfe4e11143bdac7172dc96eb5c7ad771f2043c6b:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.updateName),dacf673069e2898a02eda2fdaee2592c5168ddaf:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.requestPasswordUpdate),f4b209b662c5670856e161770ddff41c161316c9:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.signUp),f77e5f91ca87ae2c63f003f932760741033feea7:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.signInWithPassword),fc8368f5a5e69e85b8d88aa28ee67f2e0586a538:()=>Promise.resolve().then(t.bind(t,4861)).then(e=>e.signInWithEmail)};async function c(e,...r){return(await a[e]()).apply(null,r)}e.exports={"23bf5c0cf8f59322990bf558628baf2cfce62fc9":c.bind(null,"23bf5c0cf8f59322990bf558628baf2cfce62fc9"),"9d80f7b7bec96c223665e959afd89f228bdfc6d4":c.bind(null,"9d80f7b7bec96c223665e959afd89f228bdfc6d4"),"3fde3a24a853a7b9918376c70d599131c9bd7620":c.bind(null,"3fde3a24a853a7b9918376c70d599131c9bd7620"),a65f755ac9dca40b577223cfa4b7ed4d0778de79:c.bind(null,"a65f755ac9dca40b577223cfa4b7ed4d0778de79"),c8b94a55ee783ffb92b5d3be3b06325dcda2c28c:c.bind(null,"c8b94a55ee783ffb92b5d3be3b06325dcda2c28c"),c8fb0cb6630a631d4484f2603849ab0025787db1:c.bind(null,"c8fb0cb6630a631d4484f2603849ab0025787db1"),cfe4e11143bdac7172dc96eb5c7ad771f2043c6b:c.bind(null,"cfe4e11143bdac7172dc96eb5c7ad771f2043c6b"),dacf673069e2898a02eda2fdaee2592c5168ddaf:c.bind(null,"dacf673069e2898a02eda2fdaee2592c5168ddaf"),f4b209b662c5670856e161770ddff41c161316c9:c.bind(null,"f4b209b662c5670856e161770ddff41c161316c9"),f77e5f91ca87ae2c63f003f932760741033feea7:c.bind(null,"f77e5f91ca87ae2c63f003f932760741033feea7"),fc8368f5a5e69e85b8d88aa28ee67f2e0586a538:c.bind(null,"fc8368f5a5e69e85b8d88aa28ee67f2e0586a538")}},1118:(e,r,t)=>{"use strict";t.d(r,{default:()=>m});var a=t(10326),c=t(48029),s=t.n(c),i=t(17577),o=t(30467),d=t(26287),n=t.n(d);let l=()=>(0,a.jsxs)("span",{className:n().root,children:[a.jsx("span",{}),a.jsx("span",{}),a.jsx("span",{})]});var f=t(19875),u=t.n(f);let b=(0,i.forwardRef)((e,r)=>{let{className:t,variant:c="flat",children:d,active:n,width:f,loading:b=!1,disabled:m=!1,style:p={},Component:h="button",..._}=e,g=(0,i.useRef)(null),w=s()(u().root,{[u().slim]:"slim"===c,[u().loading]:b,[u().disabled]:m},t);return(0,a.jsxs)(h,{"aria-pressed":n,"data-variant":c,ref:(0,o.l)([g,r]),className:w,disabled:m,style:{width:f,...p},..._,children:[d,b&&a.jsx("i",{className:"flex pl-2 m-0",children:a.jsx(l,{})})]})});b.displayName="Button";let m=b},54554:(e,r,t)=>{"use strict";t.d(r,{Z:()=>a.default});var a=t(1118)},40731:(e,r,t)=>{"use strict";t.d(r,{p:()=>c,v:()=>s}),t(15424);var a=t(46242),c=(0,a.$)("9d80f7b7bec96c223665e959afd89f228bdfc6d4"),s=(0,a.$)("23bf5c0cf8f59322990bf558628baf2cfce62fc9")},19875:e=>{e.exports={root:"Button_root__3fIL8",loading:"Button_loading__R7Yd5",slim:"Button_slim__eaYER",disabled:"Button_disabled__wUorh"}},26287:e=>{e.exports={root:"LoadingDots_root__8o4w0",blink:"LoadingDots_blink__iunUN"}},99717:(e,r,t)=>{"use strict";t.d(r,{stripe:()=>a});let a=new(t(45272)).default(process.env.STRIPE_SECRET_KEY_LIVE??process.env.STRIPE_SECRET_KEY??"",{apiVersion:null,appInfo:{name:"Next.js Subscription Starter",version:"0.0.0",url:"https://github.com/vercel/nextjs-subscription-payments"}})},79955:(e,r,t)=>{"use strict";t.r(r),t.d(r,{checkoutWithStripe:()=>d,createStripePortal:()=>n});var a=t(27745);t(26461);var c=t(99717),s=t(15342),i=t(44777),o=t(86941);async function d(e,r="/account"){try{let t,a;let d=(0,s.createClient)(),{error:n,data:{user:l}}=await d.auth.getUser();if(n||!l)throw console.error(n),Error("Could not get user session.");try{t=await (0,i.createOrRetrieveCustomer)({uuid:l?.id||"",email:l?.email||""})}catch(e){throw console.error(e),Error("Unable to access customer record.")}let f={allow_promotion_codes:!0,billing_address_collection:"required",customer:t,customer_update:{address:"auto"},line_items:[{price:e.id,quantity:1}],cancel_url:(0,o.getURL)(),success_url:(0,o.getURL)(r)};console.log("Trial end:",(0,o.calculateTrialEndUnixTimestamp)(e.trial_period_days)),"recurring"===e.type?f={...f,mode:"subscription",subscription_data:{trial_end:(0,o.calculateTrialEndUnixTimestamp)(e.trial_period_days)}}:"one_time"===e.type&&(f={...f,mode:"payment"});try{a=await c.stripe.checkout.sessions.create(f)}catch(e){throw console.error(e),Error("Unable to create checkout session.")}if(a)return{sessionId:a.id};throw Error("Unable to create checkout session.")}catch(e){if(e instanceof Error)return{errorRedirect:(0,o.getErrorRedirect)(r,e.message,"Please try again later or contact a system administrator.")};return{errorRedirect:(0,o.getErrorRedirect)(r,"An unknown error occurred.","Please try again later or contact a system administrator.")}}}async function n(e){try{let e;let r=(0,s.createClient)(),{error:t,data:{user:a}}=await r.auth.getUser();if(!a)throw t&&console.error(t),Error("Could not get user session.");try{e=await (0,i.createOrRetrieveCustomer)({uuid:a.id||"",email:a.email||""})}catch(e){throw console.error(e),Error("Unable to access customer record.")}if(!e)throw Error("Could not get customer.");try{let{url:r}=await c.stripe.billingPortal.sessions.create({customer:e,return_url:(0,o.getURL)("/account")});if(!r)throw Error("Could not create billing portal");return r}catch(e){throw console.error(e),Error("Could not create billing portal")}}catch(r){if(r instanceof Error)return console.error(r),(0,o.getErrorRedirect)(e,r.message,"Please try again later or contact a system administrator.");return(0,o.getErrorRedirect)(e,"An unknown error occurred.","Please try again later or contact a system administrator.")}}(0,t(85723).ensureServerEntryExports)([d,n]),(0,a.registerServerReference)("23bf5c0cf8f59322990bf558628baf2cfce62fc9",d),(0,a.registerServerReference)("9d80f7b7bec96c223665e959afd89f228bdfc6d4",n)},44777:(e,r,t)=>{"use strict";t.d(r,{createOrRetrieveCustomer:()=>o}),t(86941);var a=t(99717);let c=(0,t(33661).createClient)("https://kjhcbheufrehjmmkvdja.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||""),s=async(e,r)=>{let{error:t}=await c.from("customers").upsert([{id:e,stripe_customer_id:r}]);if(t)throw Error(`Supabase customer record creation failed: ${t.message}`);return r},i=async(e,r)=>{let t=await a.stripe.customers.create({metadata:{supabaseUUID:e},email:r});if(!t)throw Error("Stripe customer creation failed.");return t.id},o=async({email:e,uuid:r})=>{let t;let{data:o,error:d}=await c.from("customers").select("*").eq("id",r).maybeSingle();if(d)throw Error(`Supabase customer lookup failed: ${d.message}`);if(o?.stripe_customer_id)t=(await a.stripe.customers.retrieve(o.stripe_customer_id)).id;else{let r=await a.stripe.customers.list({email:e});t=r.data.length>0?r.data[0].id:void 0}let n=t||await i(r,e);if(!n)throw Error("Stripe customer creation failed.");if(o&&t){if(o.stripe_customer_id!==t){let{error:e}=await c.from("customers").update({stripe_customer_id:t}).eq("id",r);if(e)throw Error(`Supabase customer record update failed: ${e.message}`);console.warn("Supabase customer record mismatched Stripe ID. Supabase record updated.")}return t}{console.warn("Supabase customer record was missing. A new record was created.");let e=await s(r,n);if(!e)throw Error("Supabase customer record creation failed.");return e}}},74826:(e,r,t)=>{"use strict";t.d(r,{M_:()=>o,PR:()=>c,Xp:()=>i,pI:()=>s});var a=t(71159);let c=(0,a.cache)(async e=>{let{data:{user:r}}=await e.auth.getUser();return r}),s=(0,a.cache)(async e=>{let{data:r,error:t}=await e.from("subscriptions").select("*, prices(*, products(*))").in("status",["trialing","active"]).maybeSingle();return r}),i=(0,a.cache)(async e=>{let{data:r,error:t}=await e.from("products").select("*, prices(*)").eq("active",!0).eq("prices.active",!0).order("metadata->index").order("unit_amount",{referencedTable:"prices"});return r}),o=(0,a.cache)(async e=>{let{data:r}=await e.from("users").select("*").single();return r})},4362:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var a=t(66621);let c=e=>[{type:"image/png",width:1686,height:882,url:(0,a.fillMetadataSegment)(".",e.params,"opengraph-image.png")+"?e0f750afbc5827b5"}]}};